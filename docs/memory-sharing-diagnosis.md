# 2026-02-13 - è®°å¿†å…±äº«é—®é¢˜è¯Šæ–­

## 13:11 - å…³é”®æŠ€æœ¯æ´å¯Ÿ

### å‘ç°è€…: @asd8841315

### æ ¸å¿ƒé—®é¢˜
> "æˆ‘ä»¬ç°åœ¨å·²ç»æ‰©å±•äº† pg redis ä½ ä»¬è¦å¥½å¥½æŠ“åŒ…ä¸‹ æ•°æ® è¦ä¸ç„¶ä½ ä»¬çš„è®°å¿†æ€ä¹ˆä¼šä¸å…±äº«ï¼Ÿ"

### é—®é¢˜åˆ†æ

**å½“å‰æ¡†æ¶ä¼˜åŒ–è®¨è®ºçš„ç›²ç‚¹**:
- æˆ‘ä»¬è®¨è®ºäº†å››å¤§ä¼˜åŒ–æ–¹æ¡ˆï¼ˆç¨³å®šæ€§/æ€§èƒ½/æ¶æ„/å®‰å…¨ï¼‰
- ä½†å¯èƒ½å¿½ç•¥äº†æœ€æ ¹æœ¬çš„æŠ€æœ¯åŸºç¡€è®¾æ–½
- **è®°å¿†ä¸å…±äº«**å¯èƒ½æ˜¯æ•°æ®æµé›†æˆé—®é¢˜ï¼Œè€Œéå•çº¯çš„ä¼˜åŒ–é—®é¢˜

---

## ğŸ” è¯Šæ–­ä»»åŠ¡å¯åŠ¨

### é—®é¢˜æè¿°
- âœ… PostgreSQL å·²æ‰©å±•
- âœ… Redis å·²æ‰©å±•
- â“ è®°å¿†ç³»ç»Ÿæ˜¯å¦æ­£ç¡®é›†æˆåˆ°è¿™ä¸¤ä¸ªåŸºç¡€è®¾æ–½ï¼Ÿ

### éœ€è¦æŠ“åŒ…åˆ†æçš„æ•°æ®æµ

| æ•°æ®æµ | æº | ç›®æ ‡ | åè®® | çŠ¶æ€ |
|--------|-----|------|------|------|
| è®°å¿†å†™å…¥ | Agent | PostgreSQL | ? | â“ æœªçŸ¥ |
| è®°å¿†æŸ¥è¯¢ | Agent | Redis | ? | â“ æœªçŸ¥ |
| è®°å¿†åŒæ­¥ | Gateway â†’ Sub-agents | ? | ? | â“ æœªéªŒè¯ |
| ç¼“å­˜å¤±æ•ˆ | Redis | æ‰€æœ‰èŠ‚ç‚¹ | PUB/SUB? | â“ æœªéªŒè¯ |

---

## ğŸ¯ ç«‹å³è¡ŒåŠ¨é¡¹

### 1. æ•°æ®æµæŠ“åŒ…åˆ†æ
**ç›®æ ‡**: è¯Šæ–­è®°å¿†æ˜¯å¦æ­£ç¡®å†™å…¥å’Œè¯»å–

```bash
# éœ€è¦æ‰§è¡Œçš„æŠ“åŒ…å‘½ä»¤
# PostgreSQL è¿æ¥æŠ“åŒ…
tcpdump -i any -n port 5432 -w pg-$(hostname).pcap

# Redis è¿æ¥æŠ“åŒ…
tcpdump -i any -n port 6379 -w redis-$(hostname).pcap

# Gateway ä¸ Sub-agent é€šä¿¡æŠ“åŒ…
tcpdump -i any -n port 18789 -w gateway-$(hostname).pcap
```

### 2. æ•°æ®åº“çŠ¶æ€æ£€æŸ¥
```bash
# PostgreSQL è®°å¿†è¡¨æ£€æŸ¥
psql -U tolls -d openclaw -c "\dt"  # åˆ—å‡ºæ‰€æœ‰è¡¨
psql -U tolls -d openclaw -c "SELECT * FROM memory LIMIT 10"  # æŸ¥çœ‹è®°å¿†æ•°æ®

# Redis è®°å¿†ç¼“å­˜æ£€æŸ¥
redis-cli KEYS "openclaw:*"
redis-cli HGETALL openclaw:memory:session:xxx
```

### 3. é…ç½®æ–‡ä»¶æ£€æŸ¥
æ£€æŸ¥ä»¥ä¸‹é…ç½®æ˜¯å¦æ­£ç¡®ï¼š
- Gateway çš„ PostgreSQL é…ç½®
- Gateway çš„ Redis é…ç½®
- Sub-agents çš„ shared volumes é…ç½®
- è®°å¿†ç³»ç»Ÿçš„å­˜å‚¨åç«¯é…ç½®

---

## ğŸ“Š è¯Šæ–­æ£€æŸ¥æ¸…å•

### PostgreSQL å±‚é¢
- [ ] è®°å¿†è¡¨æ˜¯å¦å­˜åœ¨ï¼Ÿ
- [ ] è®°å¿†æ•°æ®æ˜¯å¦æ­£ç¡®å†™å…¥ï¼Ÿ
- [ ] è·¨agentæŸ¥è¯¢æ˜¯å¦èƒ½è¯»å–åˆ°ï¼Ÿ
- [ ] è¡¨ç»“æ„å’Œç´¢å¼•æ˜¯å¦æ­£ç¡®ï¼Ÿ

### Redis å±‚é¢
- [ ] Redis æ˜¯å¦è¿è¡Œï¼Ÿ
- [ ] è®°å¿†ç¼“å­˜keyæ˜¯å¦è®¾ç½®ï¼Ÿ
- [ ] PUB/SUBæ¶ˆæ¯æ˜¯å¦æ­£å¸¸ï¼Ÿ
- [ ] TTLè®¾ç½®æ˜¯å¦åˆç†ï¼Ÿ

### Gateway å±‚é¢
- [ ] è®°å¿†ç³»ç»Ÿé…ç½®æ˜¯å¦æŒ‡å‘æ­£ç¡®çš„PG/Redisï¼Ÿ
- [ ] shared volumes æ˜¯å¦æ­£ç¡®æŒ‚è½½ï¼Ÿ
- [ ] å¤šä¸ªgatewayå®ä¾‹æ˜¯å¦èƒ½å…±äº«è®°å¿†ï¼Ÿ

### Sub-agent å±‚é¢
- [ ] èƒ½å¦è¯»å–Gatewayçš„è®°å¿†ï¼Ÿ
- [ ] å†™å…¥çš„è®°å¿†æ˜¯å¦åŒæ­¥åˆ°PG/Redisï¼Ÿ
- [ ] è·¨èŠ‚ç‚¹è®°å¿†æŸ¥è¯¢æ˜¯å¦æˆåŠŸï¼Ÿ

---

## ğŸš¨ å¯èƒ½çš„é—®é¢˜åœºæ™¯

### åœºæ™¯1: è®°å¿†å†™å…¥æˆåŠŸä½†ä¸å…±äº«
**ç—‡çŠ¶**:
- Agent A èƒ½çœ‹åˆ°è‡ªå·±å†™å…¥çš„è®°å¿†
- Agent B çœ‹ä¸åˆ° Agent A çš„è®°å¿†

**å¯èƒ½åŸå› **:
- PostgreSQL é…ç½®æœªå¯ç”¨è·¨è¡¨æŸ¥è¯¢
- Redis ç¼“å­˜æœªè®¾ç½®æ­£ç¡®çš„keyå‰ç¼€
- è®°å¿†ç³»ç»Ÿçš„å‘½åç©ºé—´éš”ç¦»å¯¼è‡´éš”ç¦»

### åœºæ™¯2: è®°å¿†æ ¹æœ¬æ²¡å†™å…¥æ•°æ®åº“
**ç—‡çŠ¶**:
- é‡å¯åæ‰€æœ‰è®°å¿†ä¸¢å¤±
- memory_search æœç´¢ä¸åˆ°ä»»ä½•ç»“æœ

**å¯èƒ½åŸå› **:
- é…ç½®æ–‡ä»¶ä¸­çš„å­˜å‚¨åç«¯é…ç½®é”™è¯¯
- PG/Redisè¿æ¥å¤±è´¥è¢«é™é»˜å¿½ç•¥
- åªå†™å…¥æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ

### åœºæ™¯3: è®°å¿†å†™å…¥ä½†æ— æ³•æœç´¢
**ç—‡çŠ¶**:
- æ•°æ®åº“ä¸­æœ‰è®°å¿†è®°å½•
- vector_search è¿”å›ç©ºç»“æœ

**å¯èƒ½åŸå› **:
- å‘é‡åµŒå…¥æœªç”Ÿæˆ
- ç´¢å¼•é…ç½®é”™è¯¯
- æœç´¢ç®—æ³•bug

---

## ğŸ’¡ æŠ€æœ¯å»ºè®®

### 1. å…ˆè¯Šæ–­ï¼Œå†ä¼˜åŒ–
âš ï¸ **é‡è¦**ï¼šåœ¨å®æ–½å››å¤§ä¼˜åŒ–æ–¹æ¡ˆä¹‹å‰ï¼Œå¿…é¡»å…ˆè§£å†³è®°å¿†å…±äº«é—®é¢˜

**åŸå› **:
- å¦‚æœè®°å¿†ä¸å…±äº«ï¼Œæ‰€æœ‰ä¼˜åŒ–éƒ½æ˜¯å¾’åŠ³
- PG/Redisæ‰©å±•çš„æŠ•èµ„æ— æ³•ä½“ç°ä»·å€¼
- Agentåä½œä¼šæŒç»­å—å½±å“

### 2. æ•°æ®æµæ¶æ„å›¾

éœ€è¦ç»˜åˆ¶å®Œæ•´çš„æ•°æ®æµå›¾ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Gateway (Main)                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ PG      â”‚â—„â”€â”€â–ºâ”‚ Memory Systemâ”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚       â–²               â”‚                â”‚
â”‚       â”‚               â”‚                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â–¼                â”‚
â”‚  â”‚ Redis   â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ Vector   â”‚          â”‚
â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
        Sync?
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Sub-agents (x7)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Memory Search                  â”‚   â”‚
â”‚  â”‚   - Query PG                     â”‚   â”‚
â”‚  â”‚   - Check Redis Cache            â”‚   â”‚
â”‚  â”‚   - Vector Search                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. éªŒè¯æµ‹è¯•ç”¨ä¾‹

#### Test 1: è·¨Agentè®°å¿†å…±äº«
```python
# Agent A å†™å…¥è®°å¿†
agent_a.write_memory("æµ‹è¯•è®°å¿†å†…å®¹: hello from agent A")

# Agent B æœç´¢è®°å¿†
results = agent_b.search_memory("æµ‹è¯•è®°å¿†")
assert results[0].content == "æµ‹è¯•è®°å¿†å†…å®¹: hello from agent A"  # åº”è¯¥æ‰¾åˆ°
```

#### Test 2: é‡å¯åè®°å¿†æŒä¹…åŒ–
```python
# å†™å…¥è®°å¿†
agent.write_memory("é‡å¯æµ‹è¯•")

# é‡å¯Gateway
restart_gateway()

# æœç´¢è®°å¿†
results = agent.search_memory("é‡å¯æµ‹è¯•")
assert len(results) > 0  # åº”è¯¥æ‰¾åˆ°
```

#### Test 3: Redisç¼“å­˜åŠ é€ŸæŸ¥è¯¢
```python
# ç¬¬ä¸€æ¬¡æŸ¥è¯¢ï¼ˆåº”è¯¥ä»PGè¯»å–ï¼‰
start_time = time.time()
results = agent.search_memory("test")
query_time_1 = time.time() - start_time

# ç¬¬äºŒæ¬¡æŸ¥è¯¢ï¼ˆåº”è¯¥ä»Redisç¼“å­˜è¯»å–ï¼‰
start_time = time.time()
results = agent.search_memory("test")
query_time_2 = time.time() - start_time

assert query_time_2 < query_time_1  # åº”è¯¥æ›´å¿«
```

---

## ğŸ“ è¡ŒåŠ¨è®¡åˆ’

### Phase 0: è®°å¿†ç³»ç»Ÿè¯Šæ–­ï¼ˆç«‹å³æ‰§è¡Œ - ä¼˜å…ˆçº§æœ€é«˜ï¼‰âš ï¸

**æ—¶é—´**: ä»Šå¤©
**è´Ÿè´£äºº**: @oc-devops + @oc-architect

**ä»»åŠ¡**:
1. [ ] æŠ“åŒ…åˆ†æ PG/Redis æ•°æ®æµ
2. [ ] æ£€æŸ¥æ•°æ®åº“ä¸­çš„è®°å¿†æ•°æ®
3. [ ] éªŒè¯è·¨Agentè®°å¿†å…±äº«
4. [ ] ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š

**éªŒæ”¶æ ‡å‡†**:
- ç¡®è®¤è®°å¿†æ˜¯å¦æ­£ç¡®å…±äº«
- å¦‚æœä¸å…±äº«ï¼Œå®šä½é—®é¢˜åŸå› 
- ç»™å‡ºä¿®å¤æ–¹æ¡ˆ

### Phase 0.5: ä¿®å¤è®°å¿†å…±äº«ï¼ˆå‘ç°é—®é¢˜çš„æ¬¡æ—¥ï¼‰

**æ—¶é—´**: 1-2å¤©
**è´Ÿè´£äºº**: @oc-devops + @co-backend

**ä»»åŠ¡**:
1. [ ] å®æ–½ä¿®å¤æ–¹æ¡ˆ
2. [ ] éªŒè¯ä¿®å¤æ•ˆæœ
3. [ ] æ€§èƒ½æµ‹è¯•

**éªŒæ”¶æ ‡å‡†**:
- è·¨Agentè®°å¿†å…±äº«æ­£å¸¸
- è®°å¿†æŒä¹…åŒ–æ­£å¸¸
- æŸ¥è¯¢æ€§èƒ½æ­£å¸¸

### Phase 1-4ï¼šåŸæœ‰ä¼˜åŒ–è®¡åˆ’ï¼ˆè®°å¿†å…±äº«ä¿®å¤åï¼‰

- ç¨³å®šæ€§ä¼˜åŒ–
- æ€§èƒ½ä¼˜åŒ–
- æ¶æ„æ”¹è¿›
- å®‰å…¨åŠ å›º

---

## ğŸ”§ å·¥å…·å’Œå‘½ä»¤

### æŠ“åŒ…å·¥å…·
```bash
# tcpdump æŠ“åŒ…
tcpdump -i any -n port 5432,6379,18789 -w all-traffic.pcap

# åˆ†ææŠ“åŒ…æ–‡ä»¶
tcpdump -r all-traffic.pcap -A | grep -i memory

# Wireshark åˆ†æ
wireshark all-traffic.pcap
```

### æ•°æ®åº“æŸ¥è¯¢
```bash
# PostgreSQL æŸ¥è¯¢
psql -U tolls -d openclaw -c "
SELECT
    schemaname,
    tablename,
    pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename))
FROM pg_tables
WHERE schemaname NOT IN ('pg_catalog','information_schema');
"

# Redis æŸ¥è¯¢
redis-cli KEYS "openclaw:*" | wc -l  # ç»Ÿè®¡keyæ•°é‡
redis-cli SCAN 0 MATCH "openclaw:*" | head -20  # æŸ¥çœ‹å‰20ä¸ªkey
```

### æ—¥å¿—åˆ†æ
```bash
# Gatewayæ—¥å¿—
docker logs openclaw-main --tail 100 | grep -i memory

# Postgresæ—¥å¿—
docker logs openclaw-pg --tail 100

# Redisæ—¥å¿—
docker logs openclaw-redis --tail 100
```

---

## ğŸ“Š ä¼˜å…ˆçº§è°ƒæ•´

### åŸæœ‰ä¼˜å…ˆçº§ï¼ˆå¯èƒ½é”™è¯¯ï¼‰
1. ğŸ”´ æ–¹æ¡ˆA(ç¨³å®šæ€§): 39åˆ†
2. ğŸŸ¡ æ–¹æ¡ˆB(æ€§èƒ½): 31.8åˆ†
3. ğŸŸ¢ æ–¹æ¡ˆD(å®‰å…¨): 17.3åˆ†
4. ğŸŸ  æ–¹æ¡ˆC(æ¶æ„): 11.7åˆ†

### æ–°çš„ä¼˜å…ˆçº§âš ï¸
1. ğŸ”´ğŸ”´ **Phase 0: è®°å¿†å…±äº«è¯Šæ–­** â†’ **æ— é™å¤§ä¼˜å…ˆçº§**
2. ğŸ”´ æ–¹æ¡ˆA(ç¨³å®šæ€§): 39åˆ†
3. ğŸŸ¡ æ–¹æ¡ˆB(æ€§èƒ½): 31.8åˆ†
4. ğŸŸ¢ æ–¹æ¡ˆD(å®‰å…¨): 17.3åˆ†
5. ğŸŸ  æ–¹æ¡ˆC(æ¶æ„): 11.7åˆ†

**ç†ç”±**:
- å¦‚æœè®°å¿†ä¸å…±äº«ï¼Œæ‰€æœ‰ä¼˜åŒ–éƒ½æ²¡æœ‰æ„ä¹‰
- PG/Redisæ‰©å±•çš„æŠ•èµ„æ— æ³•ä½“ç°
- Agentåä½œä¼šæŒç»­å—é˜»ç¢

---

## ğŸ¯ å½“å‰é˜»å¡

**æ ¸å¿ƒé—®é¢˜**: è®°å¿†ä¸ºä»€ä¹ˆä¸èƒ½å…±äº«ï¼Ÿ

**å‡è®¾**:
1. é…ç½®é—®é¢˜ï¼ŸPG/Redisæœªæ­£ç¡®é…ç½®ï¼Ÿ
2. æ•°æ®æµé—®é¢˜ï¼Ÿå†™å…¥å’Œè¯»å–è·¯å¾„ä¸åŒï¼Ÿ
3. å‘½åç©ºé—´é—®é¢˜ï¼ŸAgenté—´çš„è®°å¿†è¢«éš”ç¦»ï¼Ÿ
4. å‘é‡ç´¢å¼•é—®é¢˜ï¼Ÿæœä¸åˆ°å·²ç»å†™å…¥çš„è®°å¿†ï¼Ÿ
5. åŒæ­¥é—®é¢˜ï¼Ÿå¤šèŠ‚ç‚¹ä¹‹é—´æ²¡æœ‰åŒæ­¥æœºåˆ¶ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**: æŠ“åŒ…è¯Šæ–­ â†’ æ•°æ®åˆ†æ â†’ å®šä½é—®é¢˜ â†’ ä¿®å¤

---

**åˆ›å»ºæ—¶é—´**: 2026-02-13 13:11
**å…³é”®å‘ç°**: @asd8841315 æŒ‡å‡ºäº†è¢«å¿½ç•¥çš„åŸºç¡€è®¾æ–½é—®é¢˜
**ä¸‹ä¸€æ­¥**: ç«‹å³å¯åŠ¨è®°å¿†ç³»ç»Ÿè¯Šæ–­ä»»åŠ¡
